<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–µ—Ä–µ–Ω–æ—Å –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –≤ Supabase</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 3px solid #667eea;
        }
        .header h1 {
            color: #333;
            margin: 0;
            font-size: 2.5em;
        }
        .header p {
            color: #666;
            font-size: 1.2em;
            margin: 10px 0;
        }
        .step {
            background: #f8f9ff;
            padding: 25px;
            margin: 25px 0;
            border-radius: 12px;
            border-left: 5px solid #667eea;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        .step h2 {
            color: #333;
            margin-top: 0;
            display: flex;
            align-items: center;
        }
        .step-number {
            background: #667eea;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-weight: bold;
        }
        .code {
            background: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            margin: 15px 0;
            position: relative;
        }
        .code-header {
            background: #4a5568;
            color: #e2e8f0;
            padding: 10px 15px;
            margin: -20px -20px 15px -20px;
            border-radius: 8px 8px 0 0;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .copy-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }
        .copy-btn:hover {
            background: #5a67d8;
            transform: translateY(-2px);
        }
        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 5px solid #ffc107;
        }
        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 5px solid #28a745;
        }
        .info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 5px solid #17a2b8;
        }
        .checklist {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
        }
        .checklist ul {
            margin: 0;
            padding-left: 20px;
        }
        .checklist li {
            margin: 8px 0;
            position: relative;
        }
        .checklist li::marker {
            content: "‚òê ";
            font-size: 1.2em;
        }
        .progress-bar {
            background: #e9ecef;
            border-radius: 10px;
            height: 20px;
            margin: 20px 0;
            overflow: hidden;
        }
        .progress-fill {
            background: linear-gradient(90deg, #667eea, #764ba2);
            height: 100%;
            width: 0%;
            transition: width 0.3s ease;
            border-radius: 10px;
        }
        .btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
            transition: all 0.3s ease;
        }
        .btn:hover {
            background: #5a67d8;
            transform: translateY(-2px);
        }
        .btn-secondary {
            background: #6c757d;
        }
        .btn-secondary:hover {
            background: #5a6268;
        }
        .table-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 4px solid #667eea;
        }
        .table-info h4 {
            margin: 0 0 10px 0;
            color: #333;
        }
        .table-info p {
            margin: 5px 0;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ –ü–µ—Ä–µ–Ω–æ—Å –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –≤ Supabase</h1>
            <p>–ü–æ–ª–Ω—ã–π –ø–µ—Ä–µ–Ω–æ—Å —Å–∏—Å—Ç–µ–º—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞–º–∏ –±–∞–Ω–∫—Ä–æ—Ç—Å—Ç–≤–∞ —Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π</p>
            <div class="progress-bar">
                <div class="progress-fill" id="progressBar"></div>
            </div>
        </div>

        <div class="step">
            <h2><span class="step-number">1</span>–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –º–∏–≥—Ä–∞—Ü–∏–∏</h2>
            <div class="info">
                <strong>üìã –ß—Ç–æ –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–æ:</strong>
                <ul>
                    <li>5 –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü (clients, profiles, user_roles, payments, payment_receipts)</li>
                    <li>–°–∏—Å—Ç–µ–º–∞ —Ä–æ–ª–µ–π (admin, employee)</li>
                    <li>Row Level Security (RLS) –ø–æ–ª–∏—Ç–∏–∫–∏</li>
                    <li>Storage –¥–ª—è —Ñ–∞–π–ª–æ–≤</li>
                    <li>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç—Ä–∏–≥–≥–µ—Ä—ã –∏ —Ñ—É–Ω–∫—Ü–∏–∏</li>
                </ul>
            </div>
            <div class="checklist">
                <h4>‚úÖ –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞:</h4>
                <ul>
                    <li>–û—Ç–∫—Ä–æ–π—Ç–µ <a href="https://supabase.com/dashboard" target="_blank">Supabase Dashboard</a></li>
                    <li>–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç: <code>gidvpxxfgvivjbzfpxcg</code></li>
                    <li>–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ SQL Editor</li>
                    <li>–°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å</li>
                </ul>
            </div>
        </div>

        <div class="step">
            <h2><span class="step-number">2</span>–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏</h2>
            <div class="warning">
                <strong>‚ö†Ô∏è –í–∞–∂–Ω–æ:</strong> –í—ã–ø–æ–ª–Ω–∏—Ç–µ –≤–µ—Å—å SQL –∫–æ–¥ –æ–¥–Ω–∏–º –∑–∞–ø—Ä–æ—Å–æ–º. –ù–µ —Ä–∞–∑–±–∏–≤–∞–π—Ç–µ –Ω–∞ —á–∞—Å—Ç–∏!
            </div>
            
            <div class="code">
                <div class="code-header">
                    <span>üìÑ –ü–æ–ª–Ω—ã–π SQL –∫–æ–¥ –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏</span>
                    <button class="copy-btn" onclick="copyToClipboard('migrationCode')">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
                </div>
                <pre id="migrationCode">-- =====================================================
-- –ü–û–õ–ù–´–ô –ü–ï–†–ï–ù–û–° –ë–ê–ó–´ –î–ê–ù–ù–´–• –í SUPABASE
-- –°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞–º–∏ –±–∞–Ω–∫—Ä–æ—Ç—Å—Ç–≤–∞
-- =====================================================

-- 1. –°–û–ó–î–ê–ù–ò–ï ENUM –î–õ–Ø –†–û–õ–ï–ô
-- –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —Ç–∏–ø, –∏ —Å–æ–∑–¥–∞–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
DO $$ 
BEGIN
    IF NOT EXISTS (SELECT 1 FROM pg_type WHERE typname = 'app_role') THEN
        CREATE TYPE public.app_role AS ENUM ('admin', 'employee');
    END IF;
END $$;

-- 2. –°–û–ó–î–ê–ù–ò–ï –û–°–ù–û–í–ù–´–• –¢–ê–ë–õ–ò–¶
-- –¢–∞–±–ª–∏—Ü–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤ –±–∞–Ω–∫—Ä–æ—Ç—Å—Ç–≤–∞
CREATE TABLE public.clients (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  full_name TEXT NOT NULL,
  contract_amount DECIMAL(12,2) NOT NULL CHECK (contract_amount > 0),
  installment_period INTEGER NOT NULL CHECK (installment_period > 0),
  first_payment DECIMAL(12,2) NOT NULL CHECK (first_payment >= 0),
  monthly_payment DECIMAL(12,2) NOT NULL CHECK (monthly_payment >= 0),
  remaining_amount DECIMAL(12,2) NOT NULL DEFAULT 0 CHECK (remaining_amount >= 0),
  total_paid NUMERIC DEFAULT 0,
  deposit_paid NUMERIC DEFAULT 0,
  deposit_target NUMERIC DEFAULT 50000,
  payment_day INTEGER NOT NULL DEFAULT 1 CHECK (payment_day >= 1 AND payment_day <= 31),
  contract_date DATE NOT NULL DEFAULT CURRENT_DATE,
  user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE,
  employee_id UUID REFERENCES auth.users(id),
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- –¢–∞–±–ª–∏—Ü–∞ –ø—Ä–æ—Ñ–∏–ª–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
CREATE TABLE public.profiles (
  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,
  user_id UUID NOT NULL UNIQUE REFERENCES auth.users(id) ON DELETE CASCADE,
  full_name TEXT,
  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),
  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()
);

-- –¢–∞–±–ª–∏—Ü–∞ —Ä–æ–ª–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
CREATE TABLE public.user_roles (
    id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id uuid REFERENCES auth.users(id) ON DELETE CASCADE NOT NULL,
    role app_role NOT NULL DEFAULT 'employee',
    created_at timestamp with time zone NOT NULL DEFAULT now(),
    updated_at timestamp with time zone NOT NULL DEFAULT now(),
    created_by uuid REFERENCES auth.users(id),
    UNIQUE (user_id)
);

-- –¢–∞–±–ª–∏—Ü–∞ –ø–ª–∞—Ç–µ–∂–µ–π
CREATE TABLE public.payments (
  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,
  client_id UUID NOT NULL REFERENCES public.clients(id) ON DELETE CASCADE,
  payment_number INTEGER NOT NULL,
  original_amount NUMERIC NOT NULL,
  custom_amount NUMERIC,
  due_date DATE NOT NULL,
  is_completed BOOLEAN NOT NULL DEFAULT false,
  payment_type TEXT NOT NULL DEFAULT 'monthly',
  completed_at TIMESTAMP WITH TIME ZONE,
  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),
  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),
  user_id UUID NOT NULL REFERENCES auth.users(id),
  UNIQUE(client_id, payment_number)
);

-- –¢–∞–±–ª–∏—Ü–∞ —á–µ–∫–æ–≤ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
CREATE TABLE public.payment_receipts (
  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,
  user_id UUID NOT NULL,
  client_id UUID NOT NULL,
  payment_id UUID NULL REFERENCES public.payments(id) ON DELETE CASCADE,
  file_name TEXT NOT NULL,
  file_path TEXT NOT NULL,
  file_size INTEGER NOT NULL,
  mime_type TEXT NOT NULL,
  uploaded_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),
  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),
  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()
);

-- 3. –°–û–ó–î–ê–ù–ò–ï –ò–ù–î–ï–ö–°–û–í
CREATE INDEX idx_clients_full_name ON public.clients USING gin(to_tsvector('russian', full_name));
CREATE INDEX idx_clients_employee_id ON public.clients(employee_id);
CREATE INDEX idx_payments_client_id ON public.payments(client_id);
CREATE INDEX idx_payments_user_id ON public.payments(user_id);
CREATE INDEX idx_payments_due_date ON public.payments(due_date);

-- 4. –°–û–ó–î–ê–ù–ò–ï –§–£–ù–ö–¶–ò–ô
CREATE OR REPLACE FUNCTION public.update_updated_at_column()
RETURNS TRIGGER AS $$
BEGIN
    NEW.updated_at = NOW();
    RETURN NEW;
END;
$$ LANGUAGE plpgsql SECURITY DEFINER SET search_path = public;

CREATE OR REPLACE FUNCTION public.get_user_role(user_uuid uuid)
RETURNS app_role
LANGUAGE sql
STABLE
SECURITY DEFINER
SET search_path = public
AS $$
    SELECT role FROM public.user_roles WHERE user_id = user_uuid;
$$;

CREATE OR REPLACE FUNCTION public.is_admin(user_uuid uuid DEFAULT auth.uid())
RETURNS boolean
LANGUAGE sql
STABLE
SECURITY DEFINER
SET search_path = public
AS $$
    SELECT EXISTS (
        SELECT 1 FROM public.user_roles 
        WHERE user_id = user_uuid AND role = 'admin'
    );
$$;

CREATE OR REPLACE FUNCTION public.handle_new_user()
RETURNS trigger
LANGUAGE plpgsql
SECURITY DEFINER 
SET search_path = public
AS $$
BEGIN
  INSERT INTO public.profiles (user_id, full_name)
  VALUES (NEW.id, NEW.raw_user_meta_data->>'full_name');
  
  INSERT INTO public.user_roles (user_id, role)
  VALUES (NEW.id, 'employee'::app_role)
  ON CONFLICT (user_id) DO NOTHING;
  
  RETURN NEW;
END;
$$;

CREATE OR REPLACE FUNCTION public.create_first_admin()
RETURNS void
LANGUAGE plpgsql
SECURITY DEFINER
SET search_path = public
AS $$
BEGIN
    IF NOT EXISTS (SELECT 1 FROM public.user_roles WHERE role = 'admin') THEN
        INSERT INTO public.user_roles (user_id, role)
        SELECT id, 'admin'::app_role 
        FROM auth.users 
        ORDER BY created_at ASC 
        LIMIT 1
        ON CONFLICT (user_id) DO NOTHING;
    END IF;
END;
$$;

-- 5. –°–û–ó–î–ê–ù–ò–ï –¢–†–ò–ì–ì–ï–†–û–í
CREATE TRIGGER update_clients_updated_at
    BEFORE UPDATE ON public.clients
    FOR EACH ROW
    EXECUTE FUNCTION public.update_updated_at_column();

CREATE TRIGGER update_profiles_updated_at
  BEFORE UPDATE ON public.profiles
  FOR EACH ROW
  EXECUTE FUNCTION public.update_updated_at_column();

CREATE TRIGGER update_user_roles_updated_at
    BEFORE UPDATE ON public.user_roles
    FOR EACH ROW
    EXECUTE FUNCTION public.update_updated_at_column();

CREATE TRIGGER update_payments_updated_at
  BEFORE UPDATE ON public.payments
  FOR EACH ROW
  EXECUTE FUNCTION public.update_updated_at_column();

CREATE TRIGGER update_payment_receipts_updated_at
BEFORE UPDATE ON public.payment_receipts
FOR EACH ROW
EXECUTE FUNCTION public.update_updated_at_column();

DROP TRIGGER IF EXISTS on_auth_user_created ON auth.users;
CREATE TRIGGER on_auth_user_created
  AFTER INSERT ON auth.users
  FOR EACH ROW EXECUTE FUNCTION public.handle_new_user();

-- 6. –í–ö–õ–Æ–ß–ï–ù–ò–ï RLS
ALTER TABLE public.clients ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.profiles ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.user_roles ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.payments ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.payment_receipts ENABLE ROW LEVEL SECURITY;

-- 7. –°–û–ó–î–ê–ù–ò–ï RLS –ü–û–õ–ò–¢–ò–ö
-- Profiles
CREATE POLICY "Users can view their own profile" 
ON public.profiles FOR SELECT TO authenticated
USING (auth.uid() = user_id);

CREATE POLICY "Users can create their own profile" 
ON public.profiles FOR INSERT TO authenticated
WITH CHECK (auth.uid() = user_id);

CREATE POLICY "Users can update their own profile" 
ON public.profiles FOR UPDATE TO authenticated
USING (auth.uid() = user_id) WITH CHECK (auth.uid() = user_id);

-- User roles
CREATE POLICY "Admins can view all user roles" 
ON public.user_roles FOR SELECT USING (public.is_admin());

CREATE POLICY "Users can view their own role" 
ON public.user_roles FOR SELECT USING (auth.uid() = user_id);

CREATE POLICY "Admins can insert user roles" 
ON public.user_roles FOR INSERT WITH CHECK (public.is_admin());

CREATE POLICY "Admins can update user roles" 
ON public.user_roles FOR UPDATE USING (public.is_admin())
WITH CHECK (public.is_admin());

CREATE POLICY "Admins can delete user roles" 
ON public.user_roles FOR DELETE USING (public.is_admin());

-- Clients
CREATE POLICY "Users can view their assigned clients or admins can view all" 
ON public.clients FOR SELECT 
USING ((auth.uid() = employee_id) OR is_admin());

CREATE POLICY "Admins can create clients and assign employees" 
ON public.clients FOR INSERT 
WITH CHECK (is_admin() OR (auth.uid() = employee_id));

CREATE POLICY "Users can update their assigned clients or admins can update all" 
ON public.clients FOR UPDATE 
USING ((auth.uid() = employee_id) OR is_admin())
WITH CHECK ((auth.uid() = employee_id) OR is_admin());

CREATE POLICY "Admins can delete any clients, users can delete their assigned clients" 
ON public.clients FOR DELETE 
USING ((auth.uid() = employee_id) OR is_admin());

-- Payments
CREATE POLICY "Users can view their own payments or admins can view all" 
ON public.payments FOR SELECT 
USING (auth.uid() = user_id OR public.is_admin());

CREATE POLICY "Users can create their own payments" 
ON public.payments FOR INSERT WITH CHECK (auth.uid() = user_id);

CREATE POLICY "Users can update their own payments or admins can update all" 
ON public.payments FOR UPDATE 
USING (auth.uid() = user_id OR public.is_admin())
WITH CHECK (auth.uid() = user_id OR public.is_admin());

CREATE POLICY "Users can delete their own payments or admins can delete all" 
ON public.payments FOR DELETE 
USING (auth.uid() = user_id OR public.is_admin());

-- Payment receipts
CREATE POLICY "Users can view their own receipts or admins can view all" 
ON public.payment_receipts FOR SELECT 
USING (auth.uid() = user_id OR public.is_admin());

CREATE POLICY "Users can create their own receipts" 
ON public.payment_receipts FOR INSERT WITH CHECK (auth.uid() = user_id);

CREATE POLICY "Users can update their own receipts or admins can update all" 
ON public.payment_receipts FOR UPDATE 
USING (auth.uid() = user_id OR public.is_admin());

CREATE POLICY "Users can delete their own receipts or admins can delete all" 
ON public.payment_receipts FOR DELETE 
USING (auth.uid() = user_id OR public.is_admin());

-- 8. –ù–ê–°–¢–†–û–ô–ö–ê STORAGE
INSERT INTO storage.buckets (id, name, public) VALUES ('receipts', 'receipts', false) ON CONFLICT (id) DO NOTHING;

CREATE POLICY "Users can view their own receipt files" 
ON storage.objects FOR SELECT 
USING (bucket_id = 'receipts' AND auth.uid()::text = (storage.foldername(name))[1]);

CREATE POLICY "Users can upload their own receipt files" 
ON storage.objects FOR INSERT 
WITH CHECK (bucket_id = 'receipts' AND auth.uid()::text = (storage.foldername(name))[1]);

CREATE POLICY "Users can update their own receipt files" 
ON storage.objects FOR UPDATE 
USING (bucket_id = 'receipts' AND auth.uid()::text = (storage.foldername(name))[1]);

CREATE POLICY "Users can delete their own receipt files" 
ON storage.objects FOR DELETE 
USING (bucket_id = 'receipts' AND auth.uid()::text = (storage.foldername(name))[1]);

-- 9. –ö–û–ú–ú–ï–ù–¢–ê–†–ò–ò
COMMENT ON TABLE public.clients IS '–¢–∞–±–ª–∏—Ü–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤ –±–∞–Ω–∫—Ä–æ—Ç—Å—Ç–≤–∞ —Ñ–∏–∑–∏—á–µ—Å–∫–∏—Ö –ª–∏—Ü';
COMMENT ON TABLE public.profiles IS '–ü—Ä–æ—Ñ–∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å–∏—Å—Ç–µ–º—ã';
COMMENT ON TABLE public.user_roles IS '–†–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (admin, employee)';
COMMENT ON TABLE public.payments IS '–ì—Ä–∞—Ñ–∏–∫ –ø–ª–∞—Ç–µ–∂–µ–π –∫–ª–∏–µ–Ω—Ç–æ–≤';
COMMENT ON TABLE public.payment_receipts IS '–ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —á–µ–∫–∏ –∏ –¥–æ–∫—É–º–µ–Ω—Ç—ã';

-- 10. –°–û–ó–î–ê–ù–ò–ï –ü–ï–†–í–û–ì–û –ê–î–ú–ò–ù–ê
SELECT public.create_first_admin();</pre>
            </div>
            
            <div class="checklist">
                <h4>‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ:</h4>
                <ul>
                    <li>–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤–µ—Å—å –∫–æ–¥ –≤—ã—à–µ</li>
                    <li>–í—Å—Ç–∞–≤—å—Ç–µ –≤ SQL Editor</li>
                    <li>–ù–∞–∂–º–∏—Ç–µ "Run" –∏–ª–∏ Ctrl+Enter</li>
                    <li>–î–æ–∂–¥–∏—Ç–µ—Å—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</li>
                </ul>
            </div>
        </div>

        <div class="step">
            <h2><span class="step-number">3</span>–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü</h2>
            <div class="checklist">
                <h4>‚úÖ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ Table Editor:</h4>
                <ul>
                    <li>clients - –∫–ª–∏–µ–Ω—Ç—ã –±–∞–Ω–∫—Ä–æ—Ç—Å—Ç–≤–∞</li>
                    <li>profiles - –ø—Ä–æ—Ñ–∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</li>
                    <li>user_roles - —Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</li>
                    <li>payments - –ø–ª–∞—Ç–µ–∂–∏</li>
                    <li>payment_receipts - —á–µ–∫–∏</li>
                </ul>
            </div>
        </div>

        <div class="step">
            <h2><span class="step-number">4</span>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏</h2>
            <div class="info">
                <h4>üîê –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤:</h4>
                <p>1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ <strong>Authentication ‚Üí Settings</strong></p>
                <p>2. –í–∫–ª—é—á–∏—Ç–µ –Ω—É–∂–Ω—ã–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã (Email, Google, GitHub)</p>
                <p>3. –í <strong>URL Configuration</strong> –¥–æ–±–∞–≤—å—Ç–µ:</p>
                <ul>
                    <li>Site URL: <code>http://localhost:8080</code></li>
                    <li>Redirect URLs: <code>http://localhost:8080/**</code></li>
                </ul>
            </div>
        </div>

        <div class="step">
            <h2><span class="step-number">5</span>–ü—Ä–æ–≤–µ—Ä–∫–∞ Storage</h2>
            <div class="checklist">
                <h4>‚úÖ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ Storage:</h4>
                <ul>
                    <li>Bucket "receipts" —Å–æ–∑–¥–∞–Ω</li>
                    <li>–ü–æ–ª–∏—Ç–∏–∫–∏ –¥–æ—Å—Ç—É–ø–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã</li>
                </ul>
            </div>
        </div>

        <div class="step">
            <h2><span class="step-number">6</span>–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</h2>
            <div class="checklist">
                <h4>‚úÖ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å:</h4>
                <ul>
                    <li>–ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ: <code>npm run dev</code></li>
                    <li>–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</li>
                    <li>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è –∏ —Ä–æ–ª–∏</li>
                    <li>–°–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞</li>
                    <li>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–∞–≥—Ä—É–∑–∫—É —Ñ–∞–π–ª–æ–≤</li>
                </ul>
            </div>
        </div>

        <div class="success">
            <h3>üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º!</h3>
            <p>–í–∞—à–∞ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–∞ –≤ Supabase —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏!</p>
            <p>–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ —Å –ø–æ–ª–Ω—ã–º —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–æ–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞–º–∏ –±–∞–Ω–∫—Ä–æ—Ç—Å—Ç–≤–∞.</p>
        </div>

        <div class="table-info">
            <h4>üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü:</h4>
            <div class="table-info">
                <h4>clients</h4>
                <p>–û—Å–Ω–æ–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤ —Å –ø–æ–ª–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –¥–æ–≥–æ–≤–æ—Ä–∞—Ö, –ø–ª–∞—Ç–µ–∂–∞—Ö –∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞—Ö</p>
            </div>
            <div class="table-info">
                <h4>profiles</h4>
                <p>–ü—Ä–æ—Ñ–∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å–∏—Å—Ç–µ–º—ã, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</p>
            </div>
            <div class="table-info">
                <h4>user_roles</h4>
                <p>–†–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (admin, employee) —Å —Å–∏—Å—Ç–µ–º–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏</p>
            </div>
            <div class="table-info">
                <h4>payments</h4>
                <p>–ì—Ä–∞—Ñ–∏–∫ –ø–ª–∞—Ç–µ–∂–µ–π –∫–ª–∏–µ–Ω—Ç–æ–≤ —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏–∏</p>
            </div>
            <div class="table-info">
                <h4>payment_receipts</h4>
                <p>–ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —á–µ–∫–∏ –∏ –¥–æ–∫—É–º–µ–Ω—Ç—ã —Å –ø—Ä–∏–≤—è–∑–∫–æ–π –∫ –ø–ª–∞—Ç–µ–∂–∞–º</p>
            </div>
        </div>
    </div>

    <script>
        function copyToClipboard(elementId) {
            const element = document.getElementById(elementId);
            const text = element.textContent;
            navigator.clipboard.writeText(text).then(function() {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                const btn = event.target;
                const originalText = btn.textContent;
                btn.textContent = '‚úÖ –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!';
                btn.style.background = '#28a745';
                setTimeout(() => {
                    btn.textContent = originalText;
                    btn.style.background = '#667eea';
                }, 2000);
            }, function(err) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–∏: ', err);
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.');
            });
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–∞ –ø—Ä–∏ –ø—Ä–æ–∫—Ä—É—Ç–∫–µ
        window.addEventListener('scroll', function() {
            const scrollTop = window.pageYOffset;
            const docHeight = document.body.offsetHeight - window.innerHeight;
            const scrollPercent = (scrollTop / docHeight) * 100;
            document.getElementById('progressBar').style.width = scrollPercent + '%';
        });
    </script>
</body>
</html>
